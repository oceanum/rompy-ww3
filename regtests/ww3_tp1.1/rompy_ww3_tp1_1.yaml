# Complete WW3 ModelRun configuration for ww3_tp1.1 regression test
#
# This YAML configuration defines a complete ModelRun for the WW3 tp1.1 regression test.
# Test: 1-D propagation on spherical grid with no source terms (pure propagation).
# Reference: https://github.com/NOAA-EMC/WW3/tree/develop/regtests/ww3_tp1.1

# ModelRun parameters
run_id: "ww3_tp1_1_regression"
output_dir: "rompy_runs"

# Time configuration (24 days total, matching official test)
period:
    start: "1968-06-01T00:00:00"
    duration: "24D" # 24 days duration
    interval: "1D" # 1 day time interval

# Model configuration (equivalent to NMLConfig)
config:
    model_type: nml

    # Shell component for ww3_shel.nml (main model configuration)
    ww3_shel:
        domain:
            # Start and stop from official ww3_shel.nml
            # start: "19680601 000000"
            # stop: "19680625 000000"
            iostyp: 1 # Output server type (default)
        input_nml: {}
        output_type:
            field:
                list: "HS" # Output significant wave height only (from reference)
            point:
                file:
                    model_type: data_blob
                    source: "regtests/ww3_tp1.1/input/points.list" # Point output file
        output_date:
            # Field and point output every 24 hours (86400 seconds)
            # field:
            #     start: "19680600 000000"
            #     stride: "86400"
            #     stop: "19680625 000000"
            # point:
            #     start: "19680600 000000"
            #     stride: "86400"
            #     stop: "19680625 000000"
        homog_count:
            n_wnd: 0 # No wind input for tp1.1 (no source terms)
            n_lev: 0
            n_cur: 0
            n_ice: 0
        homog_input: []

    # Grid component for ww3_grid.nml (grid preprocessing configuration)
    ww3_grid:
        spectrum:
            xfr: 1.1 # Frequency increment from reference
            freq1: 0.03679 # First frequency (Hz) from reference
            nk: 3 # Number of frequencies (3 for tp1.1)
            nth: 4 # Number of direction bins (4 for 1-D test, from reference)
            thoff: 0.0 # Relative offset of first direction
        run:
            fldry: false # Not a dry run
            flcx: true # X-component of propagation (only flcx=T in reference)
            flcy: false # No Y-component for 1-D propagation
            flcth: false # No direction shift for 1-D
            flck: false # No wavenumber shift
            flsou: false # No source terms for this test case (pure propagation)
        timesteps:
            dtmax: 10800.0 # Maximum CFL timestep (3 hours) - adjusted to satisfy dtmax ≈ 3×dtxy
            dtxy: 3600.0 # Propagation timestep (1 hour)
            dtkth: 5400.0 # Refraction timestep (1.5 hours) - between dtmax/10 and dtmax/2
            dtmin: 10.0 # Minimum time step (10 seconds) - for source terms (none in this test)
        grid:
            name: "1-D PROPAGATION EQUATOR" # Grid name from reference
            type: "RECT" # Rectilinear grid from reference
            coord: "SPHE" # Spherical coordinates from reference
            clos: "SMPL" # Simple closure from reference
            zlim: -5.0 # Minimum depth from reference
            dmin: 5.75 # Minimum water depth from reference
        rect:
            nx: 360 # Number of points along x-axis (longitude) from reference
            ny: 3 # Number of points along y-axis (3 for 1-D test) from reference
            sx: 1.0 # Grid increment along x-axis (1 degree) from reference
            sy: 1.0 # Grid increment along y-axis (1 degree) from reference
            x0: -180.0 # Western boundary (degrees) from reference
            y0: -1.0 # Southern boundary (degrees) from reference
        depth:
            filename:
                model_type: data_blob
                source: "regtests/ww3_tp1.1/input/1-D.depth"
            sf: -2500.0 # Scale factor from reference
            idf: 50 # IDF (default)
            idla: 2 # IDLA from reference

    # Parameters component for namelists.nml (model parameters configuration)
    namelists:
        pro3:
            wdthcg: 0.0 # From namelists_1-D.nml
            wdthth: 0.0 # From namelists_1-D.nml
        pro4:
            rnfac: 0.0 # From namelists_1-D.nml
            rsfac: 0.0 # From namelists_1-D.nml

    # Field output component for ww3_ounf.nml (field output post-processing)
    ww3_ounf:
        field:
            # timestart: "19680600 000000" # Start time from reference
            timestride: "86400" # Time stride (1 day = 86400 seconds) from reference
            timecount: "999" # Number of time steps
            list: "HS" # Output significant wave height
            partition: "0 1 2" # Wave partitions
            type: 4 # Data type: REAL
            samefile: true # All variables in same file
        file:
            prefix: "ww3."
            netcdf: 3 # NetCDF version
            ix0: 1 # First X-axis index
            ixn: 1000000000 # Last X-axis index (default large value)
            iy0: 1 # First Y-axis index
            iyn: 1000000000 # Last Y-axis index (default large value)
